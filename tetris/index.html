<!DOCTYPE html>
<html>
<head>
    <title>Tetris</title>
    <meta charset="utf-8" />
    <script src="../libraries/three.min.js"></script>
    <script src="../libraries/stats.min.js"></script>
    <script src="../libraries/dat.gui.min.js"></script>
    <script src="../libraries/controls/gameControl.js"></script>
    <script src="../libraries/controls/gameButton.js"></script>
    <script src="../libraries/helpers/utils.js"></script>
    <script src="../libraries/textContainer/textContainer.js"></script>
    <script src="../libraries/helpers/timer.js"></script>
    <script src="../libraries/helpers/timer.js"></script>
    <script src="../libraries/form/button.js"></script>
    <script src="../libraries/form/divGroup.js"></script>
    <script src="../libraries/form/form.js"></script>
    <script src="../libraries/form/header.js"></script>
    <script src="../libraries/form/label.js"></script>
    <script src="../libraries/form/selector.js"></script>
    <script src="../libraries/form/textInput.js"></script>
    <script src="../libraries/socketConnection.js"></script>
    <script src="components/init.js"></script>
    <script src="components/controls.js"></script>
    <script src="components/main.js"></script>
    <script src="components/hud.js"></script>
    <script src="components/startscreen.js"></script>
    <script src="components/socket.js"></script>
    <script src="blocks/blockController.js"></script>
    <script src="blocks/quadBlock.js"></script>
    <script src="blocks/wireframe.js"></script>
    <script src="blocks/cube.js"></script>
    <script src="blocks/scoreController.js"></script>
    <link rel="stylesheet" href="../styles/style.css" />
<head>
<script>
    var MAX_WIDTH = 1000;
    var GAME_COLUMNS = 10;
    var GAME_ROWS = 25;
    var CAM_DISTANCE = 20;
    var THETA = 1e-6;
    var BLOCK_THRESHOLDTIME = 1;
    var BLOCK_VELOCITY = 4;
    var MOVE_LEFT = "left";
    var SERVER_MOVE_LEFT = "server_left";
    var MOVE_RIGHT = "right";
    var SERVER_MOVE_RIGHT = "server_right";
    var MOVE_UP = "up";
    var SERVER_MOVE_UP = "server_up";
    var MOVE_DOWN = "down";
    var SERVER_MOVE_DOWN = "server_down";
    // global variables
    var scene;
    var orthoScene;
    var control;
    var blockController;
    var isGameOver = false;

    function init() {
        orthoScene = new THREE.Scene();
        scene = new THREE.Scene();

        addOrthoCamera(-20, 100, 0, 0, 0);
        var geometry = new THREE.BoxGeometry(430, 200, 1);
        var material = new THREE.MeshBasicMaterial({color: 0xffaaff});
        var c = new THREE.Mesh(geometry, material);
        c.position.set(0, 0, -499);
        orthoScene.add(c);

        // position and point the camera to the center of the scene
        addPerspectiveCamera(45, 0.1, 20, 0, 0, CAM_DISTANCE, scene.position);

        displayGameInfo();
        initScoreListener();
        var maxWidth = getWidthFromDistance(CAM_DISTANCE, camera, MAX_WIDTH / window.innerHeight);
        var maxHeight = getHeightFromDistance(CAM_DISTANCE, camera);
        blockController = 
            new BlockController(scene, maxWidth, maxHeight, GAME_COLUMNS, GAME_ROWS, scoreController.scoreChanged, scoreController);

        // create the stats
        createStats();

        control = new function () {
            this.gameSpeed = BLOCK_VELOCITY;
            this.thresholdTime = BLOCK_THRESHOLDTIME;
        };
        addControls(control);

        initRenderer(0xAFAFAF);
        // add the output of the renderer to the html element

        //origin to left top
        var fieldWidth = blockController.getFieldWidth();
        var fieldHeight = blockController.getFieldHeight();
        scene.position.set(-fieldWidth / 2, -(fieldHeight - blockController.tileSize) / 2, 0);

        //debug
        var debugGroup = new THREE.Object3D();
        for(var x = 0; x < GAME_COLUMNS; ++x) {
            for(var y = 0; y < GAME_ROWS; ++y) {
                var c = new Cube(x * blockController.tileSize, y * blockController.tileSize, 0.1, 0xaaaaaa, 0x000000);
                debugGroup.add(c.cube);
            }
        }
        debugGroup.name = 'debug';
        scene.add(debugGroup);
      
        createForm();
    }
    
    function resize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        var maxWidth = getWidthFromDistance(CAM_DISTANCE, camera, MAX_WIDTH / window.innerHeight);
        var maxHeight = getWidthFromDistance(CAM_DISTANCE, camera);
        blockController.resize(maxWidth, maxHeight);
    }

    // calls the init function when the window is done loading.
    window.onload = init;
    window.onresize = resize;
</script>
<body>
</body>
</html>